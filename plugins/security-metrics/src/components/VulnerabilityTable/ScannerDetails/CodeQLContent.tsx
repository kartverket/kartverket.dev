import Typography from "@mui/material/Typography"

import { Vulnerability } from "../../../typesFrontend"
import { Link } from "@backstage/core-components"
import { getCweURL } from "../../utils"
import { ErrorBanner } from "../../ErrorBanner"

interface CodeQLContentProps {
    vulnerability: Vulnerability
}

const getCweInfo = (id: string) => {
    return (
        <Typography>
            <strong>{id.length > 1 ? "CWE-links: " : "CWE-link: "}</strong>
            <span key={id}>
                <Link to={getCweURL(id)}>{id}</Link>
            </span>
        </Typography>
    )
}

export const CodeQLContent = ({ vulnerability }: CodeQLContentProps) => {
    const info = vulnerability.scannerSpecificInfo.codeQLInfo
    if (!info) {
        return <ErrorBanner />
    }
    const link = new URL(info?.htmlUrl).href

    return (
        <Typography>
            {getCweInfo(vulnerability.vulnerabilityId)}
            <strong>CodeQL-link: </strong>
            <Link to={link}>
                {link.length > 80 ? link.slice(0, 30).concat("...") : link}
            </Link>
            <br />
            <strong>Branches: </strong>
            {info.branch}
            <br />
            <strong>Number of locations: </strong>
            {info.locations}
        </Typography>
    )
}
