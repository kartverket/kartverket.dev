import { Stack, Box } from '@mui/system';
import { formatDate } from 'date-fns';

import { SCANNER_CARD } from '../../colors';
import { Vulnerability } from '../../typesFrontend';
import { ScannerDetails } from './ScannerDetails/ScannerDetails';
import Collapse from '@mui/material/Collapse';
import Typography from '@mui/material/Typography';
import { useTheme } from '@mui/system';

interface Props {
  vulnerability: Vulnerability;
  open: boolean;
}

export const TableRowCollapse = ({ vulnerability, open }: Props) => {
  const theme = useTheme();

  return (
    <Collapse in={open} timeout="auto" unmountOnExit sx={{ px: 2, py: 3 }}>
      <Stack direction="row" justifyContent="space-between">
        <Stack direction="row" flexWrap="wrap">
          {vulnerability.scanners.map(s => (
            <ScannerDetails key={s} vulnerability={vulnerability} scanner={s} />
          ))}
        </Stack>
        {vulnerability.acceptedAt && (
          <Box
            display="grid"
            gap={1}
            marginRight={2}
            marginBottom={2}
            borderRadius={1}
            padding={2}
            sx={{
              borderColor: 'gray',
              backgroundColor:
                theme.palette.mode === 'dark'
                  ? SCANNER_CARD.DARK
                  : SCANNER_CARD.LIGHT,
              maxWidth: 300,
            }}
          >
            <Typography>
              <b>Akseptert av: </b>
              {vulnerability.acceptedBy}
            </Typography>

            <Typography>
              <b>Dato: </b>
              {formatDate(vulnerability.acceptedAt, 'dd.MM.yyyy')}
            </Typography>
            {vulnerability.comment && (
              <Typography>
                <b>Kommentar: </b>
                {vulnerability.comment}
              </Typography>
            )}
          </Box>
        )}
      </Stack>
    </Collapse>
  );
};
