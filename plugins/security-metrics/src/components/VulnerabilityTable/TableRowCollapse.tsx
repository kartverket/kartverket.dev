import { Stack } from '@mui/system';
import { Vulnerability } from '../../typesFrontend';
import { ScannerDetails } from './ScannerDetails/ScannerDetails';
import Collapse from '@mui/material/Collapse';
import Box from '@mui/material/Box';
import Typography from '@mui/material/Typography';
import { BASIC_COLORS } from '../../colors';
import { LastEditedBy } from './ChangeStatus/LastEditedBy';
import EditIcon from '@mui/icons-material/Edit';
import IconButton from '@mui/material/IconButton';

interface Props {
  vulnerability: Vulnerability;
  open: boolean;
  comment?: string;
  changedBy?: string;
  changedAt?: Date;
  handleOpenStatusDialog: () => void;
}

export const TableRowCollapse = ({
  vulnerability,
  open,
  comment,
  changedBy,
  changedAt,
  handleOpenStatusDialog,
}: Props) => {
  return (
    <Collapse in={open} timeout="auto" unmountOnExit sx={{ px: 2, py: 3 }}>
      <Stack spacing={2} direction="row" justifyContent="space-between">
        <Stack direction="row" justifyContent="space-between">
          <Stack direction="row" flexWrap="wrap">
            {vulnerability.scanners.map(s => (
              <ScannerDetails
                key={s}
                vulnerability={vulnerability}
                scanner={s}
              />
            ))}
          </Stack>
        </Stack>

        {comment && (
          <Box
            display="flex"
            flexDirection="column"
            justifyContent="space-between"
            m={1}
            padding={2}
            maxHeight="min-content"
            sx={{
              borderLeft: 2,
              borderColor: BASIC_COLORS.LIGHT_GREY,
            }}
          >
            <Box pb={5}>
              <Box display="flex" justifyContent="space-between" gap={1}>
                <Typography fontWeight="bold">Kommentar</Typography>
                <IconButton onClick={handleOpenStatusDialog}>
                  <EditIcon fontSize="small" />
                </IconButton>
              </Box>
              <Typography>{comment}</Typography>
            </Box>
            {changedAt && (
              <LastEditedBy
                changedBy={changedBy || 'ukjent'}
                changedAt={changedAt}
              />
            )}
          </Box>
        )}
      </Stack>
    </Collapse>
  );
};
